<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ðŸ’° Expense Tracker - Modern Dashboard</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/static/style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <header class="header">
        <h1><i class="fas fa-wallet"></i> Expense Tracker</h1>
        <p>Take control of your finances with beautiful insights</p>
      </header>

      <!-- Summary Cards -->
      <div class="summary-grid fade-in-up">
        <div class="summary-card">
          <h3><i class="fas fa-dollar-sign"></i> Total Spent</h3>
          <div class="value">${{ '%.2f' % total }}</div>
          <div class="label">All time</div>
        </div>
        <div class="summary-card">
          <h3><i class="fas fa-chart-pie"></i> Categories</h3>
          <div class="value">{{ by_cat|length }}</div>
          <div class="label">Active categories</div>
        </div>
        <div class="summary-card">
          <h3><i class="fas fa-calendar-alt"></i> This Month</h3>
          <div class="value">
            {{ by_month.values()|list|first or 0|round(2) if by_month else 0 }}
          </div>
          <div class="label">Current spending</div>
        </div>
      </div>

      <div class="grid grid-lg-2">
        <!-- Left Column: Expenses and Forms -->
        <div>
          <!-- Filter Form -->
          <form method="get" action="/" class="filter-form">
            <div class="flex-between mb-4">
              <h3><i class="fas fa-filter"></i> Filter Expenses</h3>
              <a href="/" class="btn btn-sm btn-warning">Clear</a>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">From Date</label>
                <input
                  type="date"
                  name="start"
                  class="form-input"
                  value="{{ request.query_params.get('start', '') }}"
                />
              </div>
              <div class="form-group">
                <label class="form-label">To Date</label>
                <input
                  type="date"
                  name="end"
                  class="form-input"
                  value="{{ request.query_params.get('end', '') }}"
                />
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">Category</label>
              <input
                name="category"
                class="form-input"
                placeholder="Enter category to filter..."
                value="{{ request.query_params.get('category', '') }}"
              />
            </div>
            <button type="submit" class="btn btn-primary btn-lg">
              <i class="fas fa-search"></i> Apply Filters
            </button>
          </form>

          <!-- Add Expense Form -->
          <div class="card">
            <div class="card-header">
              <i class="fas fa-plus-circle"></i> Add New Expense
            </div>
            <div class="card-body">
              <form method="post" action="/add">
                <div class="form-row form-row-3">
                  <div class="form-group">
                    <label class="form-label">Amount ($)</label>
                    <input
                      name="amount"
                      type="number"
                      step="0.01"
                      class="form-input"
                      placeholder="0.00"
                      required
                    />
                  </div>
                  <div class="form-group">
                    <label class="form-label">Date</label>
                    <input
                      name="date"
                      type="date"
                      class="form-input"
                      required
                    />
                  </div>
                  <div class="form-group">
                    <label class="form-label">Category</label>
                    <input
                      name="category"
                      class="form-input"
                      placeholder="e.g., Food, Transport"
                    />
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label">Note</label>
                  <input
                    name="note"
                    class="form-input"
                    placeholder="What did you spend on?"
                  />
                </div>
                <button type="submit" class="btn btn-success btn-lg">
                  <i class="fas fa-plus"></i> Add Expense
                </button>
              </form>
            </div>
          </div>

          <!-- Expenses Table -->
          <div class="card">
            <div class="card-header flex-between">
              <span><i class="fas fa-list"></i> Recent Expenses</span>
              <a href="/export" class="btn btn-sm btn-primary">
                <i class="fas fa-download"></i> Export CSV
              </a>
            </div>
            <div class="card-body p-0">
              {% if expenses %}
              <div class="table-container">
                <table class="table">
                  <thead>
                    <tr>
                      <th>Date</th>
                      <th>Amount</th>
                      <th>Category</th>
                      <th>Note</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for e in expenses %}
                    <tr>
                      <td>
                        <strong>{{ e.date }}</strong>
                      </td>
                      <td>
                        <span class="amount">${{ '%.2f' % e.amount }}</span>
                      </td>
                      <td>
                        {% if e.category %}
                        <span
                          class="category-badge category-{{ e.category.lower() }}"
                        >
                          {{ e.category }}
                        </span>
                        {% else %}
                        <span class="category-badge category-default"
                          >Uncategorized</span
                        >
                        {% endif %}
                      </td>
                      <td>{{ e.note or '-' }}</td>
                      <td>
                        <div class="flex gap-2">
                          <a
                            href="/edit/{{ e.id }}"
                            class="btn btn-sm btn-primary"
                          >
                            <i class="fas fa-edit"></i>
                          </a>
                          <form
                            method="post"
                            action="/delete"
                            class="inline-form"
                          >
                            <input type="hidden" name="id" value="{{ e.id }}" />
                            <button
                              type="submit"
                              class="btn btn-sm btn-danger"
                              onclick="return confirm('Delete this expense?')"
                            >
                              <i class="fas fa-trash"></i>
                            </button>
                          </form>
                        </div>
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
              {% else %}
              <div class="text-center empty-state">
                <i class="fas fa-receipt empty-icon"></i>
                <h3 class="empty-title">No expenses found</h3>
                <p class="empty-text">
                  Add your first expense using the form above!
                </p>
              </div>
              {% endif %}
            </div>
          </div>
        </div>

        <!-- Right Column: Analytics -->
        <div>
          <!-- Category Breakdown -->
          {% if by_cat %}
          <div class="card">
            <div class="card-header">
              <i class="fas fa-chart-pie"></i> Spending by Category
            </div>
            <div class="card-body">
              {% for k, v in by_cat.items() %}
              <div class="flex-between mb-4">
                <div class="flex gap-2 flex-center">
                  <span
                    class="category-badge category-{{ k.lower() if k != 'Uncategorized' else 'default' }}"
                  >
                    {{ k }}
                  </span>
                </div>
                <div>
                  <span class="amount">${{ '%.2f' % v }}</span>
                  <small class="text-secondary">
                    ({{ '%.1f' % (v / total * 100) if total > 0 else 0 }}%)
                  </small>
                </div>
              </div>
              <div class="progress-bar-bg">
                <div
                  class="progress-bar-fill"
                  style="--width: {{ (v / total * 100) if total > 0 else 0 }}%;"
                ></div>
              </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}

          <!-- Monthly Breakdown -->
          {% if by_month %}
          <div class="card">
            <div class="card-header">
              <i class="fas fa-calendar-alt"></i> Monthly Spending
            </div>
            <div class="card-body">
              {% for month, amount in by_month.items() %}
              <div class="flex-between mb-4">
                <div>
                  <strong>{{ month }}</strong>
                  <div class="month-detail">Month: {{ month }}</div>
                </div>
                <span class="amount">${{ '%.2f' % amount }}</span>
              </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}

          <!-- Quick Stats -->
          <div class="card">
            <div class="card-header">
              <i class="fas fa-chart-line"></i> Quick Stats
            </div>
            <div class="card-body">
              <div class="grid grid-md-2 gap-4">
                <div class="text-center">
                  <div class="stat-value stat-info">{{ expenses|length }}</div>
                  <div class="stat-label">Total Expenses</div>
                </div>
                <div class="text-center">
                  <div class="stat-value stat-success">
                    ${{ '%.0f' % (total / expenses|length) if expenses else 0 }}
                  </div>
                  <div class="stat-label">Average</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="/static/app.js"></script>
  </body>
</html>
